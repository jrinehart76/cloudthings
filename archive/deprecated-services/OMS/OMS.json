{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "omsRecoveryVaultRegion": {
      "type": "string",
      "defaultValue": "East US",
      "allowedValues": [
        "West US",
        "East US",
        "North Europe",
        "West Europe",
        "Brazil South",
        "East Asia",
        "Southeast Asia",
        "North Central US",
        "South Central US",
        "Japan East",
        "Japan West",
        "Australia East",
        "Australia Southeast",
        "Central US",
        "East US 2",
        "Central India",
        "South India"
      ],
      "metadata": {
        "description": "Specify the region for your Recovery Vault"
      }
    },
    "omsWorkspaceRegion": {
      "type": "string",
      "defaultValue": "East US",
      "allowedValues": [
        "East US",
        "West Europe",
        "Southeast Asia",
        "Australia Southeast"
      ],
      "metadata": {
        "description": "Specify the region for your Workspace"
      }
    },
    "omsAutomationRegion": {
      "type": "string",
      "defaultValue": "East US 2",
      "allowedValues": [
        "Japan East",
        "East US 2",
        "West Europe",
        "Southeast Asia",
        "South Central US",
        "North Europe",
        "Canada Central",
        "Australia Southeast",
        "Central India",
        "Japan East"
      ],
      "metadata": {
        "description": "Specify the region for your Automation account"
      }
    },
    "_artifactsLocation": {
      "type": "string",
      "defaultValue": "https://raw.githubusercontent.com/rtmcdo/oms/master/",
      "metadata": {
        "description": "The base URI where artifacts required by this template are located"
      }
    },
    "_artifactsLocationSasToken": {
      "type": "securestring",
      "defaultValue": "",
      "metadata": {
        "description": "The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated"
      }
    },
    "azureAdmin": {
      "type": "string",
      "metadata": {
        "description": "Enter your service admin user"
      }
    },
    "azureAdminPwd": {
      "type": "securestring",
      "metadata": {
        "description": "Enter the pwd for the service admin user. The pwd is enrypted during runtime and in the Automation assets"
      }
    },
    "location": {
      "type": "string",
      "defaultValue": "EastUS",
      "metadata": {
        "description": "Azure Region"
      }
    },
    "environment": {
      "type": "string",
      "defaultValue": "Dev",
      "metadata": {
        "description": "Environment Name - Dev, Uat, Prod, POC"
      },
      "minLength": 1,
      "maxLength": 4
    },
    "environmentAbv": {
      "type": "string",
      "defaultValue": "D",
      "metadata": {
        "description": "environment abreviation - D(ev), Q(a), P(rod)"
      },
      "minLength": 1,
      "maxLength": 1
    },
    "application": {
      "type": "string",
      "defaultValue": "LMX",
      "metadata": {
        "description": "Application - LMX, ELX, etc"
      },
      "minLength": 3,
      "maxLength": 3
    },

    "region": {
      "type": "string",
      "defaultValue": "AM",
      "metadata": {
        "description": "Geographical Region - AM, EU, AP"
      }
    },
    "applicationName": {
      "type": "string",
      "defaultValue": "NA",
      "metadata": {
        "description": "ResourceTag - Example Name: FSS_BPC_Integration"
      }
    },
    "applicationOwner": {
      "type": "string",
      "defaultValue": "NA",
      "metadata": {
        "description": "ResourceTag - Example Owner: Sai Pathak"
      }
    },
    "applicationDeveloper": {
      "type": "string",
      "defaultValue": "NA",
      "metadata": {
        "description": "ResourceTag - FSS_BPC_Integration"
      }
    },
    "applicationID": {
      "type": "string",
      "defaultValue": "NA",
      "metadata": {
        "description": "ResourceTag - "
      }
    },
    "applicationDescription": {
      "type": "string",
      "defaultValue": "NA",
      "metadata": {
        "description": "ResourceTag - Example Description: FSS application provides an automatedâ€¦."
      }
    },
    "businessOwner": {
      "type": "string",
      "defaultValue": "NA",
      "metadata": {
        "description": "ResourceTag - Example Owner: John Mo"
      }
    },
    "costCenter": {
      "type": "string",
      "defaultValue": "NA",
      "metadata": {
        "description": "ResourceTag - 123456789"
      }
    },
    "departmentOrBrand": {
      "type": "string",
      "defaultValue": "NA",
      "metadata": {
        "description": "ResourceTag - Example: Bumble Bumble"
      }
    },
    "environmentTag": {
      "type": "string",
      "defaultValue": "Development",
      "metadata": {
        "description": "ResourceTag - Environment Full Name - Development, Production"
      }
    },
    "projectID": {
      "type": "string",
      "defaultValue": "NA",
      "metadata": {
        "description": "ResourceTag - Example: P1234"
      }
    },
    "primaryFunction": {
      "type": "string",
      "defaultValue": "NA",
      "metadata": {
        "description": "ResourceTag - Example: Transporting - non sensitive data information"
      }
    },
    "installDate": {
      "type": "string",
      "defaultValue": "2018.05.29",
      "metadata": {
        "description": "ResourceTag - Format: yyyy.mm.dd"
      }
    },
    "fiscalYear": {
      "type": "string",
      "defaultValue": "FY18",
      "metadata": {
        "description": "ResourceTag - Format: FY##"
      }
    }

  },
  "variables": {
    "nestedTemplates": {
      "omsRecoveryServices": "[concat(parameters('_artifactsLocation'), '/CustomerA-Cloud/CEP/OMS/nestedtemplates/omsRecoveryServices.json', parameters('_artifactsLocationSasToken'))]",
      "omsAutomation": "[concat(parameters('_artifactsLocation'), '/CustomerA-Cloud/CEP/OMS/nestedtemplates/omsAutomation.json', parameters('_artifactsLocationSasToken'))]",
      "omsWorkspace": "[concat(parameters('_artifactsLocation'), '/CustomerA-Cloud/CEP/OMS/nestedtemplates/omsWorkspace.json', parameters('_artifactsLocationSasToken'))]"
    },
    "baseNamingPrefix": "[concat(parameters('region'), '-',  parameters('location'), '-', parameters('environment'), '-', parameters('application'))]",
    "omsRecoveryVaultName": "[concat('OMSVault-', variables('baseNamingPrefix'))]",
    "omsWorkSpaceName": "[concat('OMSWrkSpc-', variables('baseNamingPrefix'))]",
    "omsAutomationAccountName": "[concat('OMSAcct-', variables('baseNamingPrefix'))]"

  },
  "resources": [
    {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2016-02-01",
      "name": "omsWorkspace",
      "dependsOn": [
        "[concat('Microsoft.Resources/deployments/', 'omsRecoveryServices')]"
      ],
      "properties": {
        "mode": "Incremental",
        "templateLink": {
          "uri": "[variables('nestedTemplates').omsWorkspace]",
          "contentVersion": "1.0.0.0"
        },
        "parameters": {
          "omsWorkspaceName": { "value": "[variables('omsWorkspaceName')]" },
          "omsWorkspaceRegion": { "value": "[parameters('omsWorkspaceRegion')]" },
          "applicationName": { "value": "[parameters('applicationName')]" },
          "applicationOwner": { "value": "[parameters('applicationOwner')]" },
          "applicationDeveloper": { "value": "[parameters('applicationDeveloper')]" },
          "applicationID": { "value": "[parameters('applicationID')]" },
          "applicationDescription": { "value": "[parameters('applicationDescription')]" },
          "businessOwner": { "value": "[parameters('businessOwner')]" },
          "departmentOrBrand": { "value": "[parameters('departmentOrBrand')]" },
          "environment": { "value": "[parameters('environment')]" },
          "location": { "value": "[parameters('location')]" },
          "projectID": { "value": "[parameters('projectID')]" },
          "region": { "value": "[parameters('region')]" },
          "primaryFunction": { "value": "[parameters('primaryFunction')]" },
          "installDate": { "value": "[parameters('installDate')]" },
          "fiscalYear": { "value": "[parameters('fiscalYear')]" },
          "costCenter": { "value": "[parameters('costCenter')]" }
        }
      }
    },
    {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2016-02-01",
      "name": "omsRecoveryServices",
      "properties": {
        "mode": "Incremental",
        "templateLink": {
          "uri": "[variables('nestedTemplates').omsRecoveryServices]",
          "contentVersion": "1.0.0.0"
        },
        "parameters": {
          "omsRecoveryVaultName": {
            "value": "[variables('omsRecoveryVaultName')]"
          },
          "omsRecoveryVaultRegion": {
            "value": "[parameters('omsRecoveryVaultRegion')]"
          },
          "ApplicationName": { "value": "[parameters('applicationName')]" },
          "ApplicationOwner": { "value": "[parameters('applicationOwner')]" },
          "ApplicationDeveloper": { "value": "[parameters('applicationDeveloper')]" },
          "ApplicationID": { "value": "[parameters('applicationID')]" },
          "ApplicationDescription": { "value": "[parameters('applicationDescription')]" },
          "BusinessOwner": { "value": "[parameters('businessOwner')]" },
          "DepartmentOrBrand": { "value": "[parameters('departmentOrBrand')]" },
          "Environment": { "value": "[parameters('environment')]" },
          "Location": { "value": "[parameters('location')]" },
          "ProjectID": { "value": "[parameters('projectID')]" },
          "Region": { "value": "[parameters('region')]" },
          "PrimaryFunction": { "value": "[parameters('primaryFunction')]" },
          "InstallDate": { "value": "[parameters('installDate')]" },
          "FiscalYear": { "value": "[parameters('fiscalYear')]" },
          "CostCenter": { "value": "[parameters('costCenter')]" }
        }
      }
    },
    {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2016-02-01",
      "name": "omsAutomation",
      "dependsOn": [
        "[concat('Microsoft.Resources/deployments/', 'omsRecoveryServices')]",
        "[concat('Microsoft.Resources/deployments/', 'omsWorkspace')]"
      ],
      "properties": {
        "mode": "Incremental",
        "templateLink": {
          "uri": "[variables('nestedTemplates').omsAutomation]",
          "contentVersion": "1.0.0.0"
        },
        "parameters": {
          "omsAutomationAccountName": {
            "value": "[variables('omsAutomationAccountName')]"
          },
          "omsAutomationRegion": {
            "value": "[parameters('omsAutomationRegion')]"
          },
          "omsRecoveryVaultName": {
            "value": "[variables('omsRecoveryVaultName')]"
          },
          "omsWorkspaceName": {
            "value": "[variables('omsWorkspaceName')]"
          },
          "azureAdmin": {
            "value": "[parameters('azureAdmin')]"
          },
          "azureAdminPwd": {
            "value": "[parameters('azureAdminPwd')]"
          },
          "_artifactsLocation": {
            "value": "[parameters('_artifactsLocation')]"
          },
          "_artifactsLocationSasToken": {
            "value": "[parameters('_artifactsLocationSasToken')]"
          },
          "ApplicationName": { "value": "[parameters('applicationName')]" },
          "ApplicationOwner": { "value": "[parameters('applicationOwner')]" },
          "ApplicationDeveloper": { "value": "[parameters('applicationDeveloper')]" },
          "ApplicationID": { "value": "[parameters('applicationID')]" },
          "ApplicationDescription": { "value": "[parameters('applicationDescription')]" },
          "BusinessOwner": { "value": "[parameters('businessOwner')]" },
          "DepartmentOrBrand": { "value": "[parameters('departmentOrBrand')]" },
          "Environment": { "value": "[parameters('environment')]" },
          "Location": { "value": "[parameters('location')]" },
          "ProjectID": { "value": "[parameters('projectID')]" },
          "Region": { "value": "[parameters('region')]" },
          "PrimaryFunction": { "value": "[parameters('primaryFunction')]" },
          "InstallDate": { "value": "[parameters('installDate')]" },
          "FiscalYear": { "value": "[parameters('fiscalYear')]" },
          "CostCenter": { "value": "[parameters('costCenter')]" }
        }
      }
    }
  ],
  "outputs": { }
}